{% extends "base.html" %}

{% block body %}
<div class="app-container">
    <!-- Mobile Header -->
    <header class="mobile-header">
        <h2>Arbion</h2>
        <button class="hamburger" onclick="toggleSidebar()" aria-label="Меню">☰</button>
    </header>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" onclick="closeSidebar()"></div>

    <!-- Sidebar -->
    <aside class="sidebar sidebar-panel" id="sidebar">
        <div class="sidebar-header">
            <h2>Arbion</h2>
            <span class="badge badge-manager">{{ user.display_name }}</span>
        </div>

        <nav class="sidebar-nav">
            <a href="/panel" class="nav-item {% if request.url.path == '/panel' %}active{% endif %}">
                <span class="nav-icon">&#9776;</span>
                <span>Главная</span>
            </a>
            <a href="/panel/deals" class="nav-item {% if '/deals' in request.url.path %}active{% endif %}">
                <span class="nav-icon">&#128176;</span>
                <span>Мои сделки</span>
            </a>
            <a href="/panel/profile" class="nav-item {% if '/profile' in request.url.path %}active{% endif %}">
                <span class="nav-icon">&#128100;</span>
                <span>Профиль</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button onclick="logout()" class="btn btn-sm btn-outline">Выход</button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header class="content-header">
            <h1>{% block page_title %}Панель менеджера{% endblock %}</h1>
            {% block header_actions %}{% endblock %}
        </header>

        <div class="content-body">
            {% block content %}{% endblock %}
        </div>
    </main>
</div>

<script>
async function logout() {
    await fetch('/api/auth/logout', { method: 'POST' });
    window.location.href = '/login';
}

// Mobile sidebar toggle
function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.querySelector('.mobile-overlay');
    sidebar.classList.toggle('open');
    overlay.classList.toggle('active');
}

function closeSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.querySelector('.mobile-overlay');
    sidebar.classList.remove('open');
    overlay.classList.remove('active');
}

// Close sidebar when clicking on a nav link (mobile)
document.querySelectorAll('.nav-item').forEach(item => {
    item.addEventListener('click', () => {
        if (window.innerWidth <= 768) {
            closeSidebar();
        }
    });
});

// Close sidebar on escape key
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        closeSidebar();
    }
});
</script>
{% endblock %}
