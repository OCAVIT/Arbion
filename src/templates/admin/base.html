{% extends "base.html" %}

{% block body %}
<div class="app-container">
    <!-- Mobile Header -->
    <header class="mobile-header">
        <h2>Arbion</h2>
        <button class="hamburger" onclick="toggleSidebar()" aria-label="–ú–µ–Ω—é">‚ò∞</button>
    </header>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" onclick="closeSidebar()"></div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>Arbion</h2>
            <span class="badge badge-owner">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
        </div>

        <nav class="sidebar-nav">
            <div class="nav-section">–û–±–∑–æ—Ä</div>
            <a href="/admin" class="nav-item {% if request.url.path == '/admin' or request.url.path == '/admin/dashboard' %}active{% endif %}">
                <span class="nav-icon">üìä</span>
                <span>–î–∞—à–±–æ—Ä–¥</span>
            </a>

            <div class="nav-section">–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è</div>
            <a href="/admin/chats" class="nav-item {% if '/chats' in request.url.path %}active{% endif %}">
                <span class="nav-icon">üí¨</span>
                <span>–ß–∞—Ç—ã</span>
            </a>
            <a href="/admin/orders" class="nav-item {% if '/orders' in request.url.path %}active{% endif %}">
                <span class="nav-icon">üìã</span>
                <span>–ó–∞—è–≤–∫–∏</span>
            </a>
            <a href="/admin/deals" class="nav-item {% if '/deals' in request.url.path and '/managers' not in request.url.path %}active{% endif %}">
                <span class="nav-icon">üí∞</span>
                <span>–°–¥–µ–ª–∫–∏</span>
            </a>

            <div class="nav-section">–ö–æ–º–∞–Ω–¥–∞</div>
            <a href="/admin/managers" class="nav-item {% if '/managers' in request.url.path %}active{% endif %}">
                <span class="nav-icon">üë•</span>
                <span>–ú–µ–Ω–µ–¥–∂–µ—Ä—ã</span>
            </a>

            <div class="nav-section">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</div>
            <a href="/admin/finance" class="nav-item {% if '/finance' in request.url.path %}active{% endif %}">
                <span class="nav-icon">üíµ</span>
                <span>–§–∏–Ω–∞–Ω—Å—ã</span>
            </a>
            <a href="/admin/audit" class="nav-item {% if '/audit' in request.url.path %}active{% endif %}">
                <span class="nav-icon">üìù</span>
                <span>–ê—É–¥–∏—Ç</span>
            </a>

            <div class="nav-section">–°–∏—Å—Ç–µ–º–∞</div>
            <a href="/admin/settings" class="nav-item {% if '/settings' in request.url.path %}active{% endif %}">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <div class="user-info">
                üë§ {{ user.display_name }}
            </div>
            <button onclick="logout()" class="btn btn-sm btn-outline btn-block">–í—ã—Ö–æ–¥</button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header class="content-header">
            <h1>{% block page_title %}–î–∞—à–±–æ—Ä–¥{% endblock %}</h1>
            {% block header_actions %}{% endblock %}
        </header>

        <div class="content-body">
            {% block content %}{% endblock %}
        </div>
    </main>
</div>

<script>
async function logout() {
    await fetch('/api/auth/logout', { method: 'POST' });
    window.location.href = '/login';
}

// Mobile sidebar toggle
function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.querySelector('.mobile-overlay');
    sidebar.classList.toggle('open');
    overlay.classList.toggle('active');
}

function closeSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.querySelector('.mobile-overlay');
    sidebar.classList.remove('open');
    overlay.classList.remove('active');
}

// Close sidebar when clicking on a nav link (mobile)
document.querySelectorAll('.nav-item').forEach(item => {
    item.addEventListener('click', () => {
        if (window.innerWidth <= 768) {
            closeSidebar();
        }
    });
});

// Close sidebar on escape key
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        closeSidebar();
    }
});
</script>
{% endblock %}
